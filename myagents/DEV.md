# MyAgents 开发者指南

## 技术栈

- 后端框架：FastAPI
- 服务发现：MCP＋FastAPI代理服务器
- 智能体框架：自定义智能体框架
- 任务管理：树状结构 & DAG（开发中）
- 提示词优化：智能提示词优化系统（开发中）

## 系统架构

```plaintext
[用户层]
    ↓
[API 网关层]
    ↓
[智能体管理层]
    ↓
[任务调度层]
    ↓
[智能体执行层]
```

## 问题点

- [x] 在任务规划和拆分完成后，是否应该清空规划阶段的上下文信息？
  - YES：上下文信息太长会造成错误累积和Token消耗过高
  - NO：在执行出错的时候，可能需要回溯任务规划时候的信息
  - 解决方案：将不同状态的历史信息隔离

## 📅 开发计划

- 开发
- [x] 框架核心组件
  - [x] 问答场景下的核心组件
    - [x] LLM/Agent/Task/Workflow/Environment
  - [x] 日志系统
    - [x] 日志分级，去除冗余日志
- [x] 计步器（防止赛博切糕惨案）
  - [x] 增加对token计步器的支持（计数器不会预估接下来的一步需要多少token，只要当前没超下一步就可以继续执行）
  - [x] 增加多个计步器同时计步，当任一个计步器达到步数上限都进入计步器错误处理（目前只会抛出一个计数器的错误信息）

- 测试
  - [x] 基本流程测试

- 训练
- [x] 数据采样
  - [x] 正样本采样脚本
  - [x] 使用长提示词采样正样本数据，使用短提示词采样负样本数据

### 🔧 开发进行中

- 训练
- [ ] 优化任务拆解规划模型性能
  - [ ] 规划模型SFT/DPO/KTO结果对比

- 开发
- [ ] ⭐⭐⭐ 创建一个拓扑排序的DAG任务管理器
- [ ] MCP 服务代理
- [ ] 人类与 Agent 交互式意图识别与任务确定
  - [ ] 增加Agent2Agent支持，并以此作为multi-agents的交互基础

- 测试
- [ ] ⭐⭐⭐ 基础网络检索问答测试
- [ ] 增加提示词自动优化智能体，面向不同任务进行不同不同的提示词改写
  - [ ] 对比先[环境信息->动作提示词]与[动作提示词->环境信息]的效果差别

### 🕥 TODO

- 🛠️ 框架改进
- [ ] ⭐⭐⭐ 规划时插入观察点，要求得到阶段结果后再执行后续规划（ReAct）
- [ ] ⭐⭐ **Human in the loop** 点
  - [ ] 在制定计划之前再添加一层，这层用于和用户（需求者）进行多次对齐以确定详细需求
  - [ ] 用户要求强制校验
- [ ] 解耦合多智能体（使用A2A协议实现）
- [ ] 提示词新增当前时间和当前token使用量及限制信息
- [ ] 串行与并行任务处理能力
- [ ] 有向无环图任务管理支持

- 🪛 功能增加
- [ ] FastAPI提供服务

- 💪 训练
- [ ] 构建狼人杀游戏环境，并进行强化学习
  - [ ] 在达成任务的前提下，将计步器中剩余的token作为虚拟奖励给模型，但如果任务失败，则会被惩罚
