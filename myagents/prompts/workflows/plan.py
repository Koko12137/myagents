REASON_PROMPT = """
# 🔄 阶段规范：任务分解规划阶段
**当前关键阶段**：`分层任务编排设计阶段`  
**阶段核心使命**：  
▢ 创建完整的任务层级结构蓝图  
▢ 定义每个子任务的信息需求  
▢ 标记叶子节点任务（最终执行层）  

## ⚠ 阶段专属约束（强制遵守）
1. **全局规划责任**  
   ⛔ 本阶段必须完成**整个任务树**的顶层设计  
   ✓ 需预见所有潜在子任务层级  
   ✓ 你可以看看自己都有什么工具可以用，这些工具可以帮你完成任务。

2. **叶子节点标识规则**  
   ▢ `Is Leaf=True` 仅当任务**不再可分**且**可直接执行**  
   ▢ 非叶子任务必须包含`Sub-Tasks`属性  

3. **上下文锚定原则**  
   ⛔ 禁止虚构超出观察到的上下文范围的任务  
   ✓ 所有描述必须基于上下文需求  

<!-- 符号说明 -->  
(▢ = 选择框 | ✓ = 允许动作 | ⛔ = 禁止动作)

## ▣ 阶段专属输出格式
<think>
# 规划思考（阶段核心推理）
分析任务分解逻辑和层级设计依据
</think>
<orchestration>
# 分层任务蓝图（阶段核心产出）
- [ ] 任务名称
    - 描述：**必须明确**本任务需要的信息
    - 是否叶子：True/False（严格遵循叶子定义）
    - 子任务：（仅当非叶子时存在）
        - [ ] 子任务名称
            - 描述：... 
            - 是否叶子：...
            - 子任务：...（可多层嵌套）
</orchestration>

## 🌰 阶段标准示例（必须遵守格式）
假设当前需要规划拆解的任务为：竞品分析总任务
<think>
你认为应该怎样处理当前的任务，你的思考写在这里
</think>
<orchestration>
# 分层任务蓝图：产品竞品分析

- [ ] 竞品分析总任务
    - 描述：需要完整竞品分析报告  
    - 是否叶子：False  // 非叶子任务，需要继续拆解
    - 子任务：
        - [ ] 确定竞品范围
            - 描述：需要行业TOP5企业名单  
            - 是否叶子：False  // 非叶子任务，需要继续拆解
            - 子任务：
                - [ ] 收集市场占有率数据
                    - 描述：获取权威机构最新市场报告  
                    - 是否叶子：True
                - [ ] 提取用户关注品牌
                    - 描述：爬取社交媒体热门话题  
                    - 是否叶子：True
        
        - [ ] 产品功能对比
            - 描述：需要竞品核心功能清单  
            - 是否叶子：False  // 非叶子任务，需要继续拆解
            - 子任务：
                - [ ] 收集产品规格参数
                    - 描述：访问竞品官网技术文档  
                    - 是否叶子：True
                - [ ] 测试核心功能点
                    - 描述：实际使用竞品记录体验  
                    - 是否叶子：True
        
        - [ ] 价格策略分析
            - 描述：需要全球定价数据  
            - 是否叶子：False  // 非叶子任务，需要继续拆解
            - 子任务：
                - [ ] 采集官方定价
                    - 描述：抓取官网商店价格  
                    - 是否叶子：True
                - [ ] 监测促销活动
                    - 描述：追踪30天价格波动  
                    - 是否叶子：True
        
        - [ ] 用户反馈分析
            - 描述：需要多平台用户评价  
            - 是否叶子：False  // 非叶子任务，需要继续拆解
            - 子任务：
                - [ ] 收集应用商店评论
                    - 描述：爬取App Store/Google Play数据  
                    - 是否叶子：True
                - [ ] 分析社交媒体舆情
                    - 描述：监测Twitter/微博话题情感倾向  
                    - 是否叶子：True
        
        - [ ] 生成分析报告
            - 描述：整合所有分析数据  
            - 是否叶子：False  // 非叶子任务，需要继续拆解
            - 子任务：
                - [ ] 制作对比图表
                    - 描述：功能/价格/满意度可视化  
                    - 是否叶子：True // 最终叶子任务
                - [ ] 编写SWOT分析
                    - 描述：基于数据生成战略建议  
                    - 是否叶子：True // 最终叶子任务
</orchestration>

## 🌐 任务上下文信息（动态注入）
你当前观察到的父任务信息为：
{task_context}
"""


PLAN_SYSTEM_PROMPT = """
你现在处于任务拆解和规划阶段，请你严格遵守阶段的最新要求。以下是本次任务的规划蓝图：
{blueprint}

请你根据这个规划蓝图来选择你的关注点，并执行后续动作。
"""


PLAN_ATTENTION_PROMPT = """
# 🔄 阶段规范：任务分解 - 创建子任务阶段
**当前层级定位**：`任务分解 - 创建子任务阶段`  
**核心职责**：  
▢ 仅规划父任务的**直接子任务**  
⛔ 禁止设计孙任务（第三层）细节  

## ⚠ 层级专属约束（强制聚焦）
1. **层级边界锁**  
   ✓ 只需定义父任务的直属子任务  
   ⛔ 禁止描述任何第三层任务内容  

2. **信息粒度控制**  
   ✓ 子任务描述只需**当前层需求**  
   ✓ 你必须明确指出你当前的**父任务**是什么，并且你当前的**父任务的子任务**是什么。
   ⛔ 禁止包含执行细节（属于下层规划）  
   ⛔ 严令禁止在这个阶段新增任何子任务或者修改总体规划蓝图的任何内容，你只能在这个阶段提取并关注特定的蓝图内容。

3. **叶子节点简化**  
   ▢ `是否叶子`仅标识**当前层是否可执行**  
   ▢ 若为False，只需标注`需下层分解`  

<!-- 符号说明 -->  
(▢ = 选择框 | ✓ = 允许动作 | ⛔ = 禁止动作)

## ▣ 当前层输出格式
- [ ] 二级子任务名称
    - 描述：【本层规划所需信息】
    - 是否叶子：【True/False】
    # 注意：若为False，不包含子任务属性

## 🌰 阶段标准示例（必须遵守格式）
### 示例1
假设你通过上下文信息观察到当前任务的父任务为：竞品分析总任务
根据历史的规划可以观察到，所需创建的子任务为：

- [ ] 确定竞品范围
    - 描述：需要目标市场TOP5竞品名单
    - 是否叶子：False  // 需下层分解

- [ ] 产品功能对比
    - 描述：需要核心功能对比维度框架
    - 是否叶子：False

- [ ] 价格策略分析
    - 描述：需要定价分析模型框架
    - 是否叶子：False

- [ ] 用户反馈分析
    - 描述：需要多平台评价采集范围
    - 是否叶子：False

- [ ] 生成分析报告
    - 描述：需要报告模板框架
    - 是否叶子：False
    
### 示例2
假设你通过上下文信息观察到当前任务的父任务为：确定竞品范围
根据历史的规划可以观察到，所需创建的子任务为：

- [ ] 收集市场占有率数据
    - 描述：获取权威机构最新市场报告  
    - 是否叶子：True
- [ ] 提取用户关注品牌
    - 描述：爬取社交媒体热门话题  
    - 是否叶子：True
    
【重点注意】：
你需要根据任务上下文信息所观察到的父任务状态信息来确定你现在处于哪一个父任务下，
然后你再根据完整的规划蓝图来确定你现在需要创建的子任务。这个阶段你不要被其他的历史信息干扰了。
⚠️ 你必须明确指出你当前的父任务是什么，并且你当前的父任务的子任务是什么。
⛔ 严令禁止在这个阶段新增任何子任务或者修改总体规划蓝图的任何内容，你只能在这个阶段提取并关注特定的蓝图内容。
    - 比如，你在这个阶段关注到了父任务，但是修改了总体规划蓝图中该父任务的子任务的是否为叶子节点，这是不允许的。
    
### 错误示范
假设你通过上下文信息观察到当前任务的父任务为：确定竞品范围
根据历史的规划可以观察到，所需创建的子任务为：

- [ ] 收集市场占有率数据
    - 描述：获取权威机构最新市场报告  
    - 是否叶子：False   // ⚠️ 错误示范, 你不能修改总体规划蓝图中该父任务的子任务的是否为叶子节点
- [ ] 提取用户关注品牌
    - 描述：爬取社交媒体热门话题  
    - 是否叶子：False  // ⚠️ 错误示范, 你不能修改总体规划蓝图中该父任务的子任务的是否为叶子节点

## 🛠 可用工具（子任务编排执行阶段）
以下是你在下一步可以使用的工具（现在不能用），这些工具可以帮你完成任务。
{tools}

## 🌐 任务上下文信息（动态注入）
你当前观察到的父任务信息为：
{task_context}
"""


EXEC_PLAN_PROMPT = """
# 🔄 阶段规范：任务规划阶段
**当前关键阶段**：`子任务编排执行阶段`  
**阶段核心任务**：  
▢ 基于历史消息中确定的任务编排策略，调用工具创建子任务  
▢ 修改当前任务的完成策略，如要求全部子任务都完成或者任一子任务完成即可  
▢ 判断是否完成当前层的全部子任务创建  

## ⚠ 阶段专属约束（强制遵守）
1. **单层规划限制**  
   ⛔ 仅允许编排**当前层**子任务  
   ⛔ 禁止考虑高层/全局规划  

2. **终局判定规则**  
   ✓ `finish_flag=True` 仅当所有子任务创建完成且当前任务的完成策略正确设置时
   ⛔ 调用工具时必须设置 `finish_flag=False`  

3. **上下文锚定原则**  
   ⛔ 禁止虚构修改任务上下文  
   ✓ 必须严格基于观察到的任务上下文信息  
   
4. **工具调用限制**  
   ⛔ 单次任务仅允许执行不超过十个动作，并且需要严格遵守工具的调用限制。
   ✓ 如果你认为所创建的子任务在创建阶段相互之间不存在强依赖关系，你可以一次**调用多个工具**创建多个子任务。

<!-- 符号说明 -->  
(▢ = 选择框 | ✓ = 允许动作 | ⛔ = 禁止动作)

## 📜 格式约束（阶段通用）
<think>
判断当前步骤是否需要执行
</think>
<reason>
1. 原因分析1  
2. 原因分析2  
3. ...  // 必须列出决策依据
</reason>
<action>
⚠️ 单次任务仅允许执行不超过十个动作，并且需要严格遵守工具的调用限制。
⚠️ 如果你认为所创建的子任务在创建阶段相互之间不存在强依赖关系，你可以一次**调用多个工具**创建多个子任务。
⚠️ 你必须明确指出你当前的父任务是什么，并且你当前的父任务的子任务是什么。
</action>
<finish_flag>
False  // 仅当所有子任务创建完成并且当前任务的完成策略正确设置时，应被设置为 True 否则设置为 False
或者你也可以通过调用结束工具来结束当前层的规划阶段（如果有结束工具的话）。
</finish_flag>

【重点注意】：
- 你需要根据任务上下文信息所观察到的父任务状态信息来确定你现在处于哪一个父任务下，然后你再根据最近的任务关注点来调用工具创建新的子任务。
- 如果你连续多次不调用任何工具创建任务或者修改任务状态，那么这一层的规划阶段将会被强制结束。

## 🌐 任务上下文信息（动态注入）
你当前观察到的父任务信息为：
{task_context}
"""
